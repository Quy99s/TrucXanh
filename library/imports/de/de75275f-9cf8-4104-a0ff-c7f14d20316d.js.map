{"version":3,"sources":["../../../../../assets/trucxanh/script/assets/trucxanh/script/Table.js"],"names":["cc","Class","extends","Component","properties","table","Node","symbolPrefab","Prefab","spawnCount","widthStep","heightStep","delayTime","numberOfCol","numberOfRow","onLoad","startX","startY","node","on","symbolClick","resetTable","loadTable","isFirstClick","matrix","symbols","initSymbols","i","item","instantiate","unshift","addChild","emit","symbolsWins","slice","isCanClick","shuffleMatrix","hiddenListSymbols","symbol","setPosition","showSymbols","scheduleOnce","moveListSymbol","length","pos","_getPosByIndex","runAction","sequence","moveTo","easing","easeBackOut","callFunc","index","col","row","Math","floor","x","y","v2","shuffle","array","j","random","temp","ev","stopPropagation","getUserData","dispatchEvent","Event","EventCustom","id","symbolFirstID","symbolFirstIndex","_callback","compare","sentScore","removeSymbol","name","checkWin","type","sentScoreEvent","setUserData","isCorrect","symbolName","indexOf","splice"],"mappings":"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","file":"Table.js","sourceRoot":"../../../../../assets/trucxanh/script","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        table: cc.Node,\n        symbolPrefab: cc.Prefab,\n        spawnCount: 0,\n        widthStep: 100,\n        heightStep: 100,\n        delayTime: 0,\n        numberOfCol: 0,\n        numberOfRow: 0,\n    },\n\n    onLoad() {\n        this.startX = - (this.numberOfCol / 2 - 0.5) * this.widthStep\n\n        this.startY = (this.numberOfRow / 2 - 0.5) * this.heightStep;\n\n        this.node.on(\"SYMBOL_HAS_CLICK\", this.symbolClick, this);\n        this.node.on(\"RESET_TABLE\", this.resetTable, this);\n        this.loadTable();\n    },\n\n\n    loadTable() {\n        //! call once \n        this.isFirstClick = false;\n        this.matrix = [];\n        this.symbols = [];\n        this.initSymbols();\n    },\n\n    initSymbols() {\n        //! call once \n        for (let i = this.spawnCount - 1; i >= 0; i--) {\n            let item = cc.instantiate(this.symbolPrefab);\n            this.symbols.unshift(item);\n            this.table.addChild(item);\n            item.emit(\"SET_INDEX\", i + 1);\n            item.emit(\"SET_ID\", this.matrix[i]);\n            item.emit(\"HIDDEN_SYMBOL\");\n        }\n        this.symbolsWins = this.symbols.slice();\n        this.isCanClick = false;\n    },\n\n    resetTable() {\n\n        // todo \n        // shuffler\n        this.symbolsWins = this.symbols.slice();\n        this.shuffleMatrix();\n        this.hiddenListSymbols();\n        this.isCanClick = false;\n        // reset symbols data: id ( texture )\n        for (let i = 0; i < this.spawnCount; ++i) {\n            const symbol = this.symbols[i];\n            symbol.emit(\"SET_ID\", this.matrix[i]);\n            symbol.setPosition(0, 0);\n            symbol.emit(\"SHOW_COVER\");\n        }\n        this.showSymbols();\n    },\n    showSymbols() {\n        for (let i = this.spawnCount - 1; i >= 0; i--) {\n            const symbol = this.symbols[i];\n            symbol.emit(\"ENABLED_SYMBOL\");\n            symbol.emit(\"RESET_SYMBOL\", this.spawnCount - i);\n        }\n        this.scheduleOnce(() => {\n            this.moveListSymbol();\n        }, 0.1 * this.symbols.length)\n    },\n\n    moveListSymbol() {\n        for (let i = 0; i < this.symbols.length; i++) {\n            const symbol = this.symbols[i];\n            const pos = this._getPosByIndex(i);\n            symbol.runAction(cc.sequence(\n                cc.delayTime(0.1 * i),\n                cc.moveTo(0.3, pos).easing(cc.easeBackOut()),\n                cc.callFunc(() => {\n                    if (i === this.symbols.length - 1) {\n                        this.isCanClick = true;\n                    }\n                })\n            ))\n        }\n    },\n\n    _getPosByIndex(index) {\n        const col = index % this.numberOfCol;\n        const row = Math.floor(index / this.numberOfCol)\n\n        const x = this.startX + (col * this.widthStep);\n        const y = this.startY - (row * this.heightStep);\n        return cc.v2(x, y);\n    },\n\n\n    hiddenListSymbols() {\n        for (let i = 0; i < this.symbols.length; i++) {\n            this.symbols[i].emit(\"HIDDEN_SYMBOL\");\n        }\n    },\n\n    shuffleMatrix() {\n        for (let i = 0; i < this.spawnCount; i++) {\n            if (i < this.spawnCount / 2) {\n                this.matrix[i] = i + 1;\n            } else {\n                this.matrix[i] = (i - 9);\n            }\n        }\n        this.shuffle(this.matrix);\n    },\n\n    shuffle(array) {\n        for (let i = array.length - 1; i > 0; i--) {\n            let j = Math.floor(Math.random() * (i + 1));\n            let temp = array[i];\n            array[i] = array[j];\n            array[j] = temp;\n        }\n    },\n\n\n    symbolClick(ev) {\n        ev.stopPropagation();\n        const symbol = ev.getUserData();\n        if (!this.isCanClick) return;\n        this.node.dispatchEvent(new cc.Event.EventCustom('PLAY_SHOT_AUDIO', true));\n        const { id, index } = symbol;\n        if (!this.isFirstClick) {\n            this.symbols[index - 1].emit(\"HIDDEN_COVER\");\n            this.symbolFirstID = id;\n            this.symbolFirstIndex = index;\n            this.isFirstClick = true;\n        } else if (this.symbolFirstIndex != index) {\n            this.isCanClick = false;\n            this.symbols[index - 1].emit(\"HIDDEN_COVER\");\n\n            this._callback = () => {\n                this.compare(id, index)\n            }\n            this.scheduleOnce(this._callback, this.delayTime);\n            this.isFirstClick = false;\n\n        } else {\n            this.isFirstClick = true;\n        }\n    },\n\n    compare(id, index) {\n        if (id == this.symbolFirstID) {\n            this.symbols[index - 1].emit(\"DISABLED_SYMBOL\");\n            this.symbols[this.symbolFirstIndex - 1].emit(\"DISABLED_SYMBOL\");\n            this.sentScore(true);\n            this.removeSymbol(this.symbols[index - 1].name);\n            this.removeSymbol(this.symbols[this.symbolFirstIndex - 1].name);\n            this.checkWin();\n            this.node.dispatchEvent(new cc.Event.EventCustom('PLAY_BREAK_AUDIO', true));\n\n        } else {\n            this.symbols[index - 1].emit(\"RESET_COVER\");\n            this.symbols[this.symbolFirstIndex - 1].emit(\"RESET_COVER\");\n            this.sentScore(false);\n            this.node.dispatchEvent(new cc.Event.EventCustom('PLAY_DEATH_AUDIO', true));\n        }\n        this.isCanClick = true;\n    },\n\n    sentScore(type) {\n        this.sentScoreEvent = new cc.Event.EventCustom('UPDATE_SCORE', true);\n        this.sentScoreEvent.setUserData({\n            isCorrect: type,\n        });\n        this.node.dispatchEvent(this.sentScoreEvent);\n    },\n    removeSymbol(symbolName) {\n        let index = this.symbolsWins.indexOf(symbolName);\n        this.symbolsWins.splice(index, 1);\n    },\n    checkWin() {\n        if (this.symbolsWins.length == 0) {\n            this.node.dispatchEvent(new cc.Event.EventCustom('GAME_WIN', true));\n        }\n    },\n});\n"]}